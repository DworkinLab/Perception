---
title: "Main Plots and Analysis of Perception Data"
---

```{r, include=FALSE}
source('Perception_Analysis.R')
```


### Sex Correlation Plot:
```{r, echo=FALSE}
with(DGRP_sub, cor(prop_spider[Sex == "Female"],prop_spider[Sex == "Male"] ))
```

```{r, echo=FALSE}
line2 <- lm(DGRP_sub$prop_spider[DGRP_sub$Sex == "Female"] ~ DGRP_sub$prop_spider[DGRP_sub$Sex == "Male"])

with(DGRP_sub, plot(x = prop_spider[Sex == "Female"],y = prop_spider[Sex == "Male"], xlab = "Females", ylab = "Males", abline(line2), main = "Male Female correlation: proportion with spider"))
```


### Models:

Model 1: DGRP Lines
```
mod2 <- glmer(cbind(Spider, Not_spider) ~ 0+DGRP + Temp_Scaled + Humidity_Scaled + BP_Scaled + (1|Date), data = DGRP_by_counts, family = "binomial")
```
```{r}
#print(summary(mod2), correlation = TRUE)
Anova(mod2)
plot(effect("DGRP", mod2), ylab = "Proportion with spider", rotx = 90)
```

Order into own plot with ggplot
```
eff_plot <- effect("DGRP", mod2)
eff_plot <- as.data.frame(eff_plot)
#eff_plot
p_eff <- ggplot(eff_plot, aes(y = fit, x = reorder(DGRP,fit))) + 
  geom_point(size = 2) + 
  geom_errorbar(aes(ymin = lower, ymax = upper), size = 1.2, width = 0.2) +
  labs(y = "Fit", x = "DGRP Line") + 
  ggtitle("DGRP effect plot") +
  geom_hline(yintercept = 0.5, size=0.25) +
  theme(plot.title = element_text(size=22)) +
  theme(axis.text.x = element_text(angle=90, hjust = 1))
```

```{r}
print(p_eff)
```


Model 2: Sex Effects:

```
mod3 <- lmer(proportion_spider ~ DGRP:Sex + Sex + DGRP + Temp_Scaled + Humidity_Scaled + BP_Scaled + (1|Date), data = DGRP_by_counts)
```
```{r}
#print(summary(mod3), correlation = TRUE)
Anova(mod3)

plot(effect("DGRP:Sex", mod3), multiline = TRUE, rotx = 90)
xx <- plot(effect("DGRP*Sex", mod3), multiline = FALSE, rotx = 90)
xx
```

ggplot to order effects plot
```
dgrp_sex <- effect("DGRP*Sex", mod3)
dgrp_sex <- as.data.frame(dgrp_sex)

p_sex <- ggplot(data=dgrp_sex, aes(x=DGRP, y=fit, colour=Sex))+ 
  geom_point(size = 3, alpha=0.5) + 
  geom_errorbar(aes(ymin = lower, ymax = upper), size = 1.2, width = 0.2) +
  labs(y = "Fit", x = "DGRP Line") + 
  ggtitle("DGRP and Sex; proportion with spider effects plot") +
  geom_hline(yintercept = 0.5, size=0.35, alpha=0.5) +
  theme(plot.title = element_text(size=22)) +
  theme(axis.text.x = element_text(angle=90, hjust = 1))
```
```{r}
p_sex
```


Model 3
```{r}
mod1 <- glmer(cbind(Not_spider, Spider) ~ 1 + Sex + Temp_Scaled + Humidity_Scaled + BP_Scaled + (1|Date) 
              + (0 + Sex|DGRP), data = DGRP_by_counts, family = "binomial")
summary(mod1)
```


